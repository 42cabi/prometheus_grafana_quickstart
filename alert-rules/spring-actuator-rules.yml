groups:
  - name: application-status-rules
    rules:
      - alert: InstanceDown
        expr: up{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"} == 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "ğŸš¨ {{ $labels.instance }} ì„œë²„ê°€ ì£½ì—ˆì–´ìš”.. ğŸš¨"
          description: "{{ $labels.instance }} ì„œë²„ê°€ 1ë¶„ ì´ìƒ ì£½ì–´ìˆì–´ìš”.. ì¡°ì¹˜ê°€ í•„ìš”í•´ìš”."

      - alert: HighProcessCpuUsage
        expr: (avg by (instance) (process_cpu_usage{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"}) * 100) > 70
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "âš ï¸ {{ $labels.instance }} ì„œë²„ì—ì„œ ë†’ì€ í”„ë¡œì„¸ìŠ¤ CPU ì‚¬ìš©ë¥  ê°ì§€ëì–´ìš”: {{ $value }}% âš ï¸"
          description: "{{ $labels.instance }} ì„œë²„ì—ì„œ ìµœê·¼ 1ë¶„ ë™ì•ˆ í”„ë¡œì„¸ìŠ¤ CPU ì‚¬ìš©ë¥ ì´ 70%ë¥¼ ë„˜ì—ˆì–´ìš”. í”„ë¡œì„¸ìŠ¤ê°€ ê³¼ë„í•˜ê²Œ CPUë¥¼ ì‚¬ìš©í•˜ê³  ìˆì„ ìˆ˜ ìˆì–´ìš”."

      - alert: HighSystemCpuUsage
        expr: (avg by (instance) (system_cpu_usage{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"}) * 100) > 70
        for: 1m
        labels:
          severity: warning
        annotations:
          summary: "âš ï¸ {{ $labels.instance }} ì„œë²„ì—ì„œ ë†’ì€ ì‹œìŠ¤í…œ CPU ì‚¬ìš©ë¥  ê°ì§€ëì–´ìš”: {{ $value }}% âš ï¸"
          description: "{{ $labels.instance }} ì„œë²„ì—ì„œ ìµœê·¼ 1ë¶„ ë™ì•ˆ ì‹œìŠ¤í…œ CPU ì‚¬ìš©ë¥ ì´ 70%ë¥¼ ë„˜ì—ˆì–´ìš”. ì‹œìŠ¤í…œ ë¦¬ì†ŒìŠ¤ ì‚¬ìš©ì´ ê³¼ë„í•  ìˆ˜ ìˆì–´ìš”."

  - name: hikaricp-connection-rules
    rules:
      - alert: HighActiveConnectionRatio
        expr: (hikaricp_connections_active{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"} / (hikaricp_connections_active{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"} + hikaricp_connections_idle{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"})) > 0.8
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "âš ï¸ {{ $labels.instance }}ì„œë²„ì—ì„œ í™œì„± ì—°ê²° ë¹„ìœ¨ì´ ë„ˆë¬´ ë†’ì•„ìš”: {{ $value }}% âš ï¸"
          description: "{{ $labels.instance }}ì„œë²„ì—ì„œ ìµœê·¼ 5ë¶„ ë™ì•ˆ HikariCPì˜ ì—°ê²° ì¤‘ 80% ì´ìƒì´ í™œì„± ìƒíƒœì…ë‹ˆë‹¤. ë¶€í•˜ê°€ ë†’ê±°ë‚˜ í’€ í¬ê¸°ê°€ ë¶€ì¡±í•  ìˆ˜ ìˆì–´ìš”."

      - alert: HighPendingConnectionRatio
        expr: (hikaricp_connections_pending{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"} / (hikaricp_connections_active{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"} + hikaricp_connections_idle{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"} + hikaricp_connections_pending{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"})) > 0.1
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ğŸš¨ {{ $labels.instance }}ì„œë²„ì—ì„œ ëŒ€ê¸° ì—°ê²° ë¹„ìœ¨ì´ ë„ˆë¬´ ë†’ì•„ìš”: {{ $value }}% ğŸš¨"
          description: "{{ $labels.instance }}ì„œë²„ì—ì„œ ìµœê·¼ 5ë¶„ ë™ì•ˆ HikariCPì˜ ì „ì²´ ì—°ê²° ëŒ€ë¹„ 10% ì´ìƒì´ ëŒ€ê¸° ì¤‘ì…ë‹ˆë‹¤. ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²°ì— ì‹¬ê°í•œ ë³‘ëª© í˜„ìƒì´ ë°œìƒí•  ìˆ˜ ìˆì–´ìš”."

  - name: jvm-memory-usage-rules
    rules:
      - alert: HighJVMHeapMemoryUsage
        expr: (sum by(instance) (jvm_memory_used_bytes{area="heap", job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"}) * 100 / sum by(instance) (jvm_memory_max_bytes{area="heap", job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"})) > 70
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ğŸš¨ {{ $labels.instance }}ì„œë²„ì—ì„œ JVM í™ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ ë†’ì•„ìš”: {{ $value }}% ğŸš¨"
          description: "{{ $labels.instance }}ì„œë²„ì—ì„œ ìµœê·¼ 5ë¶„ ë™ì•ˆ JVM í™ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ 70%ë¥¼ ì´ˆê³¼í–ˆì–´ìš”. ë©”ëª¨ë¦¬ ëˆ„ìˆ˜ ê°€ëŠ¥ì„±ì´ ìˆê±°ë‚˜ ì• í”Œë¦¬ì¼€ì´ì…˜ì´ ê³¼ë„í•œ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ê³  ìˆì„ ìˆ˜ ìˆì–´ìš”."

      - alert: HighJVMNonHeapMemoryUsage
        expr: (sum by(instance) (jvm_memory_used_bytes{area="nonheap", job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"}) * 100 / sum by(instance) (jvm_memory_max_bytes{area="nonheap", job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"})) > 70
        for: 5m
        labels:
          severity: critical
        annotations:
          summary: "ğŸš¨ {{ $labels.instance }}ì„œë²„ì—ì„œ JVM ë¹„í™ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ ë†’ì•„ìš”: {{ $value }}% ğŸš¨"
          description: "{{ $labels.instance }}ì„œë²„ì—ì„œ ìµœê·¼ 5ë¶„ ë™ì•ˆ JVM ë¹„í™ ë©”ëª¨ë¦¬ ì‚¬ìš©ë¥ ì´ 70%ë¥¼ ì´ˆê³¼í–ˆì–´ìš”. ì‹œìŠ¤í…œ ë¼ì´ë¸ŒëŸ¬ë¦¬ ë˜ëŠ” JVM ìì²´ì˜ ë©”ëª¨ë¦¬ ìš”êµ¬ê°€ ì¦ê°€í–ˆì„ ìˆ˜ ìˆì–´ìš”."

  - name: http-traffic-rules
    rules:
      - alert: HighHttpRequestRate
        expr: sum by(instance) (rate(http_server_requests_seconds_count{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"}[1m])) > 1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "âš ï¸ {{ $labels.instance }}ì„œë²„ì—ì„œ HTTP ìš”ì²­ ì²˜ë¦¬ìœ¨ì´ ë†’ì•„ìš”: {{ $value }}% âš ï¸"
          description: "{{ $labels.instance }}ì„œë²„ì—ì„œ ì´ˆë‹¹ ìš”ì²­ ì²˜ë¦¬ìœ¨ì´ 1ì„ ì´ˆê³¼í•˜ê³  ìˆì–´ìš”. íŠ¸ë˜í”½ ì¦ê°€ ë˜ëŠ” ì ì¬ì ì¸ ì„œë¹„ìŠ¤ ë³‘ëª© í˜„ìƒì„ í™•ì¸í•´ì£¼ì„¸ìš”."

      - alert: HighHttpRequestRateByUriMethod
        expr: sum by(uri, method, instance) (rate(http_server_requests_seconds_count{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%"}[1m])) > 5
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "âš ï¸ {{ $labels.instance }}ì„œë²„ì—ì„œ {{ $labels.method }} {{ $labels.uri }} ìš”ì²­ ì²˜ë¦¬ìœ¨ì´ ë†’ì•„ìš”: {{ $value }}% âš ï¸"
          description: "{{ $labels.instance }}ì„œë²„ì—ì„œ {{ $labels.method }} ë°©ì‹ìœ¼ë¡œ {{ $labels.uri }} URIì— ëŒ€í•œ ì´ˆë‹¹ ìš”ì²­ ì²˜ë¦¬ìœ¨ì´ 5ì„ ì´ˆê³¼í•˜ê³  ìˆì–´ìš”. í•´ë‹¹ URIì— ëŒ€í•œ ìš”ì²­ ì²˜ë¦¬ ë¡œì§ì´ ë¹„íš¨ìœ¨ì ì¼ ìˆ˜ ìˆì–´ìš”."

      - alert: HighHttpResponseTime
        expr: sum by (instance) (rate(http_server_requests_seconds_sum{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%", status!~"5.."}[1m])) / sum by (instance) (rate(http_server_requests_seconds_count{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%", status!~"5.."}[1m])) > 0.1
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "âš ï¸ {{ $labels.instance }}ì„œë²„ì—ì„œ HTTP ì‘ë‹µ ì‹œê°„ì´ ë†’ì•„ìš”: {{ $value }}s âš ï¸"
          description: "{{ $labels.instance }}ì„œë²„ì—ì„œ ìµœê·¼ 5ë¶„ ë™ì•ˆ HTTP ì‘ë‹µ ì‹œê°„ì´ 0.1ì´ˆë¥¼ ì´ˆê³¼í•˜ê³  ìˆì–´ìš”. ì„œë¹„ìŠ¤ ì‘ë‹µ ì‹œê°„ì´ ì˜ˆìƒë³´ë‹¤ ëŠë¦´ ìˆ˜ ìˆìœ¼ë©°, ì„±ëŠ¥ ìµœì í™”ê°€ í•„ìš”í•  ìˆ˜ ìˆì–´ìš”."

  - name: http-error-rules
    rules:
      - alert: HighHttp4xxErrorRate
        expr: sum by(instance) (rate(http_server_requests_seconds_count{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%", status=~"4.."}[1m])) > 0.2
        for: 5m
        labels:
          severity: warning
        annotations:
          summary: "âš ï¸ {{ $labels.instance }}ì„œë²„ì—ì„œ 4xx ì˜¤ë¥˜ìœ¨ì´ ë†’ì•„ìš”: {{ $value }}ê°œ/ì´ˆ"
          description: "{{ $labels.instance }}ì„œë²„ì—ì„œ HTTP 4xx ì˜¤ë¥˜ ì‘ë‹µì´ ì´ˆë‹¹ 0.2ê°œë¥¼ ì´ˆê³¼í•˜ê³  ìˆì–´ìš”. ì´ëŠ” í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ ì˜¤ë¥˜ê°€ ì˜ˆìƒë³´ë‹¤ ë§ì´ ë°œìƒí•˜ê³  ìˆìŒì„ ë‚˜íƒ€ë‚´ë©°, ì…ë ¥ ìœ íš¨ì„± ê²€ì‚¬ ë˜ëŠ” ìš”ì²­ ì²˜ë¦¬ ë¡œì§ì˜ ê°œì„ ì´ í•„ìš”í•  ìˆ˜ ìˆì–´ìš”."

      - alert: ServerErrorOccurred
        expr: changes(http_server_requests_seconds_count{job="%%PM_SPRING_ACTUATOR_JOB_NAME%%", instance=~".*", status=~"5.."}[1m]) > 0
        for: 1m
        labels:
          severity: critical
        annotations:
          summary: "ğŸš¨ {{ $labels.instance }}ì„œë²„ì—ì„œ HTTP 500 ì˜¤ë¥˜ ë°œìƒ ğŸš¨"
          description: "{{ $labels.instance }} ì„œë²„ì—ì„œ '{{ $labels.method }} {{ $labels.uri }}' ìš”ì²­ ì²˜ë¦¬ ì¤‘ '{{ $labels.exception }}' ì˜ˆì™¸ê°€ ë°œìƒí•˜ì—¬ ì„œë²„ ì˜¤ë¥˜({{ $labels.status }}) ê°€ ë°œìƒí–ˆì–´ìš”. {{ $labels.outcome }} ìƒíƒœë¥¼ í™•ì¸í•˜ì„¸ìš”."
